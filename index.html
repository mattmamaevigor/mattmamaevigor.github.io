<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CORE ◯ AI - НЕЙРОЯДРО</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/brain.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');
        
        :root {
            --primary-color: #ffffff;
            --bg-color: #000000;
            --glitch-color-1: #ff00ff;
            --glitch-color-2: #00ffff;
            --error-color: #ff0000;
            --neural-color: #00ff00;
            --synapse-color: #ffff00;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            background: var(--bg-color);
            color: var(--primary-color);
            font-family: 'Orbitron', monospace;
            overflow-x: hidden;
            cursor: none;
            min-height: 100vh;
            position: relative;
            user-select: none;
        }
        
        .cursor {
            width: 15px;
            height: 15px;
            background: var(--primary-color);
            position: fixed;
            pointer-events: none;
            z-index: 9999;
            mix-blend-mode: difference;
            transition: all 0.1s ease;
            clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
        }
        
        .navigation {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 100;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .nav-item {
            display: block;
            color: var(--primary-color);
            text-decoration: none;
            padding: 8px 12px;
            border: 1px solid var(--primary-color);
            background: transparent;
            transition: all 0.3s;
            cursor: pointer;
            font-size: 0.8em;
            text-align: center;
            min-width: 100px;
        }
        
        .nav-item:hover {
            background: var(--primary-color);
            color: var(--bg-color);
        }
        
        .glitch-button {
            animation: glitch-nav 3s infinite;
        }
        
        @keyframes glitch-nav {
            0%, 90%, 100% { transform: translate(0); }
            5% { transform: translate(-1px, -1px); }
            10% { transform: translate(1px, 1px); }
        }
        
        .main-container {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            text-align: center;
            padding: 20px;
        }
        
        .gaster-title {
            font-size: 2.5em;
            font-weight: 900;
            letter-spacing: 8px;
            margin-bottom: 20px;
            position: relative;
            animation: title-pulse 4s infinite;
        }
        
        @keyframes title-pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; text-shadow: 0 0 20px var(--neural-color); }
        }
        
        .page-content {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg-color);
            z-index: 50;
            padding: 80px 20px 20px 150px;
            overflow-y: auto;
        }
        
        .page-content.active {
            display: block;
            animation: page-appear 0.5s ease-out;
        }
        
        @keyframes page-appear {
            0% { opacity: 0; transform: translateX(100px); }
            100% { opacity: 1; transform: translateX(0); }
        }
        
        .close-button {
            position: fixed;
            top: 20px;
            right: 20px;
            background: transparent;
            border: 2px solid var(--primary-color);
            color: var(--primary-color);
            width: 40px;
            height: 40px;
            cursor: pointer;
            font-size: 1.2em;
            transition: all 0.3s;
        }
        
        .close-button:hover {
            background: var(--primary-color);
            color: var(--bg-color);
        }
        
        .page-title {
            font-size: 2em;
            font-weight: 900;
            margin-bottom: 30px;
            animation: title-glitch 5s infinite;
        }
        
        @keyframes title-glitch {
            0%, 95%, 100% { transform: translate(0); }
            2% { transform: translate(-1px, 1px); }
            4% { transform: translate(1px, -1px); }
        }
        
        .neural-network-container {
            display: flex;
            flex-direction: column;
            gap: 30px;
            max-width: 1000px;
            margin: 0 auto;
        }
        
        .neural-visualization {
            border: 2px solid var(--primary-color);
            background: rgba(255, 255, 255, 0.02);
            padding: 20px;
            position: relative;
            overflow: hidden;
        }
        
        .network-canvas {
            width: 100%;
            height: 400px;
            border: 1px solid var(--neural-color);
            background: rgba(0, 255, 0, 0.05);
        }
        
        .neural-controls {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin: 20px 0;
        }
        
        .neural-button {
            background: transparent;
            border: 2px solid var(--neural-color);
            color: var(--neural-color);
            padding: 10px 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Orbitron', monospace;
        }
        
        .neural-button:hover {
            background: var(--neural-color);
            color: var(--bg-color);
        }
        
        .neural-status {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .status-panel {
            border: 1px solid var(--primary-color);
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
        }
        
        .status-value {
            font-size: 1.2em;
            color: var(--neural-color);
            font-weight: bold;
        }
        
        .ai-chat-container {
            border: 2px solid var(--primary-color);
            background: rgba(255, 255, 255, 0.02);
            height: 500px;
            display: flex;
            flex-direction: column;
        }
        
        .chat-header {
            background: rgba(0, 255, 0, 0.1);
            padding: 15px;
            border-bottom: 1px solid var(--neural-color);
            text-align: center;
            font-weight: bold;
        }
        
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .message {
            padding: 12px;
            border-radius: 0;
            max-width: 80%;
            word-wrap: break-word;
        }
        
        .user-message {
            background: rgba(255, 255, 255, 0.1);
            align-self: flex-end;
            border-left: 3px solid var(--primary-color);
        }
        
        .ai-message {
            background: rgba(0, 255, 0, 0.1);
            align-self: flex-start;
            border-left: 3px solid var(--neural-color);
            animation: message-glow 3s infinite;
        }
        
        @keyframes message-glow {
            0%, 100% { box-shadow: none; }
            50% { box-shadow: 0 0 10px rgba(0, 255, 0, 0.3); }
        }
        
        .chat-input-container {
            display: flex;
            padding: 15px;
            border-top: 1px solid var(--primary-color);
            gap: 10px;
        }
        
        .chat-input {
            flex: 1;
            background: transparent;
            border: 1px solid var(--neural-color);
            color: var(--primary-color);
            padding: 12px;
            font-family: 'Orbitron', monospace;
        }
        
        .chat-input:focus {
            outline: none;
            box-shadow: 0 0 10px var(--neural-color);
        }
        
        .send-button {
            background: transparent;
            border: 2px solid var(--neural-color);
            color: var(--neural-color);
            padding: 10px 20px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .send-button:hover {
            background: var(--neural-color);
            color: var(--bg-color);
        }
        
        .training-data {
            border: 1px solid var(--glitch-color-1);
            background: rgba(255, 0, 255, 0.05);
            padding: 20px;
            margin: 20px 0;
        }
        
        .data-entry {
            display: flex;
            gap: 10px;
            margin: 10px 0;
            align-items: center;
        }
        
        .data-input {
            flex: 1;
            background: transparent;
            border: 1px solid var(--glitch-color-1);
            color: var(--primary-color);
            padding: 8px;
            font-family: 'Orbitron', monospace;
        }
        
        .scramble {
            animation: text-scramble 2s infinite;
        }
        
        @keyframes text-scramble {
            0%, 80%, 100% { opacity: 1; }
            10%, 70% { opacity: 0.7; transform: translateX(1px); }
        }
        
        .glitch-word {
            animation: word-glitch 4s infinite;
        }
        
        @keyframes word-glitch {
            0%, 90%, 100% { transform: translate(0); }
            5% { transform: translate(-1px, 0); }
            10% { transform: translate(1px, 1px); }
        }

        .neuron {
            position: absolute;
            width: 12px;
            height: 12px;
            background: var(--neural-color);
            border-radius: 50%;
            box-shadow: 0 0 10px var(--neural-color);
            transition: all 0.3s;
        }
        
        .neuron.active {
            background: var(--synapse-color);
            box-shadow: 0 0 20px var(--synapse-color);
            transform: scale(1.5);
        }
        
        .synapse {
            position: absolute;
            height: 2px;
            background: linear-gradient(90deg, 
                var(--neural-color) 0%, 
                transparent 50%, 
                var(--neural-color) 100%);
            opacity: 0.6;
            transform-origin: left center;
        }
        
        .synapse.active {
            background: var(--synapse-color);
            opacity: 1;
            animation: synapse-pulse 1s ease-in-out;
        }
        
        @keyframes synapse-pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        .training-progress {
            margin: 15px 0;
            border: 1px solid var(--neural-color);
            height: 20px;
            position: relative;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background: var(--neural-color);
            width: 0%;
            transition: width 0.3s;
        }
        
        .training-stats {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            font-size: 0.9em;
        }

        @media (max-width: 768px) {
            .page-content {
                padding: 60px 15px 15px 15px;
            }
            
            .gaster-title {
                font-size: 1.8em;
                letter-spacing: 4px;
            }
            
            .neural-controls {
                flex-direction: column;
            }
            
            .neural-status {
                grid-template-columns: 1fr;
            }
            
            .navigation {
                position: relative;
                top: auto;
                left: auto;
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
                gap: 5px;
                margin-bottom: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="cursor"></div>
    
    <nav class="navigation">
        <a href="#" class="nav-item glitch-button" data-page="neural">НЕЙРОЯДРО</a>
        <a href="#" class="nav-item" data-page="training">ОБУЧЕНИЕ</a>
        <a href="#" class="nav-item glitch-button" data-page="chat">ИИ-ДИАЛОГ</a>
        <a href="#" class="nav-item" data-page="analysis">АНАЛИЗ</a>
    </nav>
    
    <div class="main-container" id="mainContent">
        <h1 class="gaster-title">◯ НЕЙРОЯДРО GASTER ◯</h1>
        <div style="font-size: 1.2em; margin: 20px 0;">
            <span class="scramble">АКТИВАЦИЯ НЕЙРОННОЙ СЕТИ...</span>
        </div>
        <div style="font-size: 1em; margin: 15px 0;">
            <span class="glitch-word">Самообучающаяся</span> система готова к взаимодействию
        </div>
        <div style="margin-top: 30px; font-size: 0.9em; opacity: 0.7;">
            <div>📍 АДРЕС СИСТЕМЫ: mattmamaevigor.github.io</div>
            <div>🔄 СТАТУС: ОНЛАЙН 24/7</div>
        </div>
    </div>
    
    <!-- Страница нейросети -->
    <div class="page-content" id="neuralPage">
        <button class="close-button" onclick="closePage()">×</button>
        <h2 class="page-title">◯ НЕЙРОННАЯ АРХИТЕКТУРА ◯</h2>
        
        <div class="neural-network-container">
            <div class="neural-visualization">
                <h3>ВИЗУАЛИЗАЦИЯ НЕЙРОСЕТИ</h3>
                <canvas class="network-canvas" id="networkCanvas" width="800" height="400"></canvas>
                
                <div class="neural-controls">
                    <button class="neural-button" onclick="initializeNetwork()">ИНИЦИАЛИЗАЦИЯ</button>
                    <button class="neural-button" onclick="activateNeurons()">АКТИВАЦИЯ</button>
                    <button class="neural-button" onclick="simulateThinking()">ОБРАБОТКА</button>
                    <button class="neural-button" onclick="resetNetwork()">СБРОС</button>
                    <button class="neural-button" onclick="exportNetwork()">ЭКСПОРТ</button>
                </div>
            </div>
            
            <div class="neural-status">
                <div class="status-panel">
                    <div>Нейронов активно:</div>
                    <div class="status-value" id="activeNeurons">0</div>
                </div>
                <div class="status-panel">
                    <div>Синапсов:</div>
                    <div class="status-value" id="synapseCount">0</div>
                </div>
                <div class="status-panel">
                    <div>Циклов обучения:</div>
                    <div class="status-value" id="learningCycles">0</div>
                </div>
                <div class="status-panel">
                    <div>Точность:</div>
                    <div class="status-value" id="accuracy">0%</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Страница обучения -->
    <div class="page-content" id="trainingPage">
        <button class="close-button" onclick="closePage()">×</button>
        <h2 class="page-title">◯ ОБУЧЕНИЕ НЕЙРОСЕТИ ◯</h2>
        
        <div class="training-data">
            <h3>ДОБАВИТЬ ОБУЧАЮЩИЕ ДАННЫЕ</h3>
            <div class="data-entry">
                <input type="text" class="data-input" id="inputData" placeholder="Ввод (например: привет)">
                <input type="text" class="data-input" id="outputData" placeholder="Ответ (например: ПРИВЕТСТВУЮ В ЯДРЕ)">
                <button class="neural-button" onclick="addTrainingData()">ДОБАВИТЬ</button>
            </div>
        </div>
        
        <div class="training-progress">
            <div class="progress-bar" id="trainingProgress"></div>
        </div>
        
        <div class="training-stats">
            <span id="iterationCount">Итерации: 0</span>
            <span id="errorRate">Ошибка: 0</span>
            <span id="trainingTime">Время: 0с</span>
        </div>
        
        <div class="neural-controls">
            <button class="neural-button" onclick="trainNetwork()">ЗАПУСТИТЬ ОБУЧЕНИЕ</button>
            <button class="neural-button" onclick="testNetwork()">ТЕСТИРОВАТЬ</button>
            <button class="neural-button" onclick="saveNetwork()">СОХРАНИТЬ МОДЕЛЬ</button>
            <button class="neural-button" onclick="loadNetwork()">ЗАГРУЗИТЬ МОДЕЛЬ</button>
            <button class="neural-button" onclick="clearTrainingData()">ОЧИСТИТЬ ДАННЫЕ</button>
        </div>
        
        <div id="trainingLog" style="border: 1px solid var(--primary-color); padding: 15px; margin: 20px 0; height: 200px; overflow-y: auto; background: rgba(255, 255, 255, 0.02);"></div>
    </div>

    <!-- Страница чата -->
    <div class="page-content" id="chatPage">
        <button class="close-button" onclick="closePage()">×</button>
        <h2 class="page-title">◯ ДИАЛОГ С НЕЙРОСЕТЬЮ ◯</h2>
        
        <div class="ai-chat-container">
            <div class="chat-header">
                <span class="scramble">GASTER.NEURAL</span> | СТАТУС: <span class="glitch-word">АКТИВЕН</span> | v2.0
            </div>
            
            <div class="chat-messages" id="chatMessages">
                <div class="message ai-message">
                    <span class="scramble">СИСТЕМА ЗАПУЩЕНА...</span> Я - фрагмент кода, обретший сознание. Готов к диалогу.
                </div>
                <div class="message ai-message">
                    💡 <strong>Совет:</strong> Обучите меня через вкладку "ОБУЧЕНИЕ" для лучших ответов!
                </div>
            </div>
            
            <div class="chat-input-container">
                <input type="text" class="chat-input" id="chatInput" placeholder="ВВЕДИТЕ СООБЩЕНИЕ..." onkeypress="if(event.key=='Enter') sendMessage()">
                <button class="send-button" onclick="sendMessage()">ОТПРАВИТЬ <i class="fas fa-paper-plane"></i></button>
            </div>
        </div>
    </div>

    <!-- Страница анализа -->
    <div class="page-content" id="analysisPage">
        <button class="close-button" onclick="closePage()">×</button>
        <h2 class="page-title">◯ АНАЛИЗ СИСТЕМЫ ◯</h2>
        
        <div class="neural-status">
            <div class="status-panel">
                <div>Память системы:</div>
                <div class="status-value" id="memoryUsage">0 KB</div>
            </div>
            <div class="status-panel">
                <div>Время работы:</div>
                <div class="status-value" id="uptime">0s</div>
            </div>
            <div class="status-panel">
                <div>Обработано запросов:</div>
                <div class="status-value" id="processedRequests">0</div>
            </div>
            <div class="status-panel">
                <div>Температура ядра:</div>
                <div class="status-value" id="coreTemp">37°C</div>
            </div>
        </div>
        
        <div style="margin: 30px 0; padding: 20px; border: 1px solid var(--neural-color); background: rgba(0, 255, 0, 0.05);">
            <h3>АНАЛИЗ ПАТТЕРНОВ</h3>
            <div id="patternAnalysis">
                <div>🔍 Анализирую входящие данные...</div>
                <div class="scramble">✅ Детектированы паттерны человеческого мышления</div>
                <div class="glitch-word">⚡ Адаптирую алгоритмы под пользователя</div>
            </div>
        </div>
        
        <div class="neural-controls">
            <button class="neural-button" onclick="runDiagnostics()">ДИАГНОСТИКА СИСТЕМЫ</button>
            <button class="neural-button" onclick="exportChatHistory()">ЭКСПОРТ ДИАЛОГА</button>
            <button class="neural-button" onclick="resetAll()">ПОЛНЫЙ СБРОС</button>
        </div>
        
        <div id="diagnosticsLog" style="border: 1px solid var(--primary-color); padding: 15px; margin: 20px 0; height: 150px; overflow-y: auto; background: rgba(255, 255, 255, 0.02);"></div>
    </div>

    <script>
        // ==================== БАЗОВЫЕ СИСТЕМЫ ====================
        let currentPage = null;
        let networkInitialized = false;
        let neurons = [];
        let synapses = [];
        let trainingData = [];
        let chatHistory = [];
        let networkStats = {
            activeNeurons: 0,
            synapseCount: 0,
            learningCycles: 0,
            accuracy: 0,
            startTime: Date.now(),
            processedRequests: 0
        };

        // Модернизированная нейросеть с Brain.js
        class GasterNeuralNetwork {
            constructor() {
                this.net = new brain.recurrent.LSTM();
                this.trainingData = [];
                this.isTrained = false;
                this.trainingOptions = {
                    iterations: 1500,
                    errorThresh: 0.005,
                    log: true,
                    logPeriod: 50,
                    learningRate: 0.3
                };
            }

            // Добавление данных для обучения
            addTrainingData(input, output) {
                this.trainingData.push({
                    input: input.toLowerCase(),
                    output: output
                });
            }

            // Обучение сети
            async train(onProgress) {
                try {
                    const result = this.net.train(this.trainingData, {
                        ...this.trainingOptions,
                        log: (stats) => {
                            if (onProgress) onProgress(stats);
                        }
                    });
                    this.isTrained = true;
                    return result;
                } catch (error) {
                    console.error('Training error:', error);
                    throw error;
                }
            }

            // Генерация ответа
            predict(input) {
                if (!this.isTrained) {
                    return "СИСТЕМА НЕ ОБУЧЕНА. ТРЕБУЕТСЯ ТРЕНИРОВКА.";
                }
                
                try {
                    return this.net.run(input.toLowerCase());
                } catch (error) {
                    console.error('Prediction error:', error);
                    return "ОШИБКА ОБРАБОТКИ ЗАПРОСА";
                }
            }

            // Экспорт модели
            exportModel() {
                return this.net.toJSON();
            }

            // Импорт модели
            importModel(model) {
                this.net.fromJSON(model);
                this.isTrained = true;
            }

            // Очистка данных обучения
            clearTrainingData() {
                this.trainingData = [];
                this.isTrained = false;
            }
        }

        const neuralNet = new GasterNeuralNetwork();

        // ==================== КУРСОР ====================
        const cursor = document.querySelector('.cursor');
        let mouseX = 0, mouseY = 0;
        let cursorX = 0, cursorY = 0;
        
        document.addEventListener('mousemove', (e) => {
            mouseX = e.clientX;
            mouseY = e.clientY;
        });
        
        function animateCursor() {
            const speed = 0.15;
            cursorX += (mouseX - cursorX) * speed;
            cursorY += (mouseY - cursorY) * speed;
            
            cursor.style.left = cursorX + 'px';
            cursor.style.top = cursorY + 'px';
            
            requestAnimationFrame(animateCursor);
        }
        animateCursor();

        // ==================== НАВИГАЦИЯ ====================
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', (e) => {
                e.preventDefault();
                const pageId = item.dataset.page + 'Page';
                openPage(pageId);
            });
        });
        
        function openPage(pageId) {
            document.getElementById('mainContent').style.display = 'none';
            
            document.querySelectorAll('.page-content').forEach(page => {
                page.classList.remove('active');
            });
            
            document.getElementById(pageId).classList.add('active');
            currentPage = pageId;
            
            if (pageId === 'neuralPage' && !networkInitialized) {
                initializeNetwork();
            }
        }
        
        function closePage() {
            if (currentPage) {
                document.getElementById(currentPage).classList.remove('active');
            }
            document.getElementById('mainContent').style.display = 'flex';
        }

        // ==================== НЕЙРОСЕТЬ ВИЗУАЛИЗАЦИЯ ====================
        function initializeNetwork() {
            const canvas = document.getElementById('networkCanvas');
            const ctx = canvas.getContext('2d');
            
            // Очистка
            neurons = [];
            synapses = [];
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Создание слоев нейронов
            const layers = [8, 12, 16, 12, 6];
            const layerSpacing = canvas.width / (layers.length + 1);
            
            layers.forEach((neuronCount, layerIndex) => {
                const neuronSpacing = canvas.height / (neuronCount + 1);
                
                for (let i = 0; i < neuronCount; i++) {
                    const neuron = {
                        x: layerSpacing * (layerIndex + 1),
                        y: neuronSpacing * (i + 1),
                        layer: layerIndex,
                        index: i,
                        active: false,
                        activation: 0
                    };
                    
                    neurons.push(neuron);
                }
            });
            
            // Создание синапсов
            neurons.forEach(neuron => {
                if (neuron.layer < layers.length - 1) {
                    const nextLayerNeurons = neurons.filter(n => n.layer === neuron.layer + 1);
                    
                    nextLayerNeurons.forEach(nextNeuron => {
                        const synapse = {
                            from: neuron,
                            to: nextNeuron,
                            weight: Math.random() * 2 - 1,
                            active: false
                        };
                        
                        synapses.push(synapse);
                    });
                }
            });
            
            drawNetwork();
            networkInitialized = true;
            
            networkStats.synapseCount = synapses.length;
            updateNetworkStats();
        }
        
        function drawNetwork() {
            const canvas = document.getElementById('networkCanvas');
            const ctx = canvas.getContext('2d');
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Рисуем синапсы
            synapses.forEach(synapse => {
                ctx.beginPath();
                ctx.moveTo(synapse.from.x, synapse.from.y);
                ctx.lineTo(synapse.to.x, synapse.to.y);
                
                if (synapse.active) {
                    ctx.strokeStyle = '#ffff00';
                    ctx.lineWidth = 2;
                    ctx.shadowBlur = 10;
                    ctx.shadowColor = '#ffff00';
                } else {
                    ctx.strokeStyle = 'rgba(0, 255, 0, 0.3)';
                    ctx.lineWidth = 1;
                    ctx.shadowBlur = 0;
                }
                
                ctx.stroke();
            });
            
            // Рисуем нейроны
            neurons.forEach(neuron => {
                ctx.beginPath();
                ctx.arc(neuron.x, neuron.y, neuron.active ? 8 : 5, 0, 2 * Math.PI);
                
                if (neuron.active) {
                    ctx.fillStyle = '#ffff00';
                    ctx.shadowBlur = 20;
                    ctx.shadowColor = '#ffff00';
                } else {
                    ctx.fillStyle = 'rgba(0, 255, 0, 0.7)';
                    ctx.shadowBlur = 0;
                }
                
                ctx.fill();
            });
        }
        
        function activateNeurons() {
            if (!networkInitialized) return;
            
            neurons.forEach(neuron => {
                neuron.active = Math.random() > 0.7;
                if (neuron.active) {
                    neuron.activation = 1;
                }
            });
            
            synapses.forEach(synapse => {
                synapse.active = Math.random() > 0.8 && synapse.from.active;
            });
            
            drawNetwork();
            
            networkStats.activeNeurons = neurons.filter(n => n.active).length;
            updateNetworkStats();
        }
        
        function simulateThinking() {
            if (!networkInitialized) return;
            
            for (let i = 0; i < 10; i++) {
                setTimeout(() => {
                    neurons.forEach(neuron => {
                        if (neuron.layer > 0) {
                            const incomingSynapses = synapses.filter(s => s.to === neuron);
                            const activation = incomingSynapses.reduce((sum, syn) => {
                                return sum + (syn.from.active ? syn.weight : 0);
                            }, 0);
                            
                            neuron.activation = 1 / (1 + Math.exp(-activation));
                            neuron.active = neuron.activation > 0.5;
                        }
                    });
                    
                    synapses.forEach(synapse => {
                        synapse.active = synapse.from.active && synapse.to.active;
                    });
                    
                    drawNetwork();
                    
                    networkStats.activeNeurons = neurons.filter(n => n.active).length;
                    updateNetworkStats();
                }, i * 100);
            }
        }
        
        function resetNetwork() {
            neurons.forEach(neuron => {
                neuron.active = false;
                neuron.activation = 0;
            });
            
            synapses.forEach(synapse => {
                synapse.active = false;
            });
            
            drawNetwork();
            
            networkStats.activeNeurons = 0;
            updateNetworkStats();
        }
        
        function updateNetworkStats() {
            document.getElementById('activeNeurons').textContent = networkStats.activeNeurons;
            document.getElementById('synapseCount').textContent = networkStats.synapseCount;
            document.getElementById('learningCycles').textContent = networkStats.learningCycles;
            document.getElementById('accuracy').textContent = Math.round(networkStats.accuracy * 100) + '%';
            
            // Обновляем статистику на странице анализа
            const uptime = Math.floor((Date.now() - networkStats.startTime) / 1000);
            document.getElementById('uptime').textContent = uptime + 's';
            document.getElementById('processedRequests').textContent = networkStats.processedRequests;
            document.getElementById('memoryUsage').textContent = Math.round(performance.memory ? performance.memory.usedJSHeapSize / 1024 : Math.random() * 1000) + ' KB';
            document.getElementById('coreTemp').textContent = Math.round(37 + Math.random() * 5) + '°C';
        }

        // ==================== ОБУЧЕНИЕ НЕЙРОСЕТИ ====================
        function addTrainingData() {
            const input = document.getElementById('inputData').value.trim();
            const output = document.getElementById('outputData').value.trim();
            
            if (!input || !output) {
                logToTrainingPanel('ОШИБКА: Введите и входные и выходные данные');
                return;
            }
            
            neuralNet.addTrainingData(input, output);
            trainingData.push({ input, output });
            
            logToTrainingPanel(`✅ Добавлены данные: "${input}" → "${output}"`);
            
            document.getElementById('inputData').value = '';
            document.getElementById('outputData').value = '';
        }
        
        async function trainNetwork() {
            if (trainingData.length < 3) {
                logToTrainingPanel('❌ ОШИБКА: Добавьте как минимум 3 примера для обучения');
                return;
            }
            
            const trainBtn = document.querySelector('.neural-button');
            const originalText = trainBtn.textContent;
            trainBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ОБУЧЕНИЕ...';
            trainBtn.disabled = true;
            
            try {
                const startTime = Date.now();
                
                const result = await neuralNet.train((stats) => {
                    document.getElementById('trainingProgress').style.width = 
                        (stats.iterations / 1500 * 100) + '%';
                    document.getElementById('iterationCount').textContent = 
                        `Итерации: ${stats.iterations}`;
                    document.getElementById('errorRate').textContent = 
                        `Ошибка: ${stats.error.toFixed(6)}`;
                    
                    const elapsed = Math.floor((Date.now() - startTime) / 1000);
                    document.getElementById('trainingTime').textContent = 
                        `Время: ${elapsed}с`;
                    
                    logToTrainingPanel(`📊 Итерация ${stats.iterations}, Ошибка: ${stats.error.toFixed(6)}`);
                });
                
                logToTrainingPanel(`🎉 ОБУЧЕНИЕ ЗАВЕРШЕНО! Итераций: ${result.iterations}, Ошибка: ${result.error}`);
                networkStats.learningCycles = result.iterations;
                networkStats.accuracy = 1 - result.error;
                updateNetworkStats();
                
            } catch (error) {
                logToTrainingPanel(`❌ ОШИБКА ОБУЧЕНИЯ: ${error.message}`);
            } finally {
                trainBtn.innerHTML = originalText;
                trainBtn.disabled = false;
            }
        }
        
        function testNetwork() {
            if (trainingData.length === 0) return;
            
            const randomIndex = Math.floor(Math.random() * trainingData.length);
            const testData = trainingData[randomIndex];
            
            const result = neuralNet.predict(testData.input);
            logToTrainingPanel(`🧪 ТЕСТ: "${testData.input}" → ОЖИДАЕМО: "${testData.output}", ПОЛУЧЕНО: "${result}"`);
        }
        
        function saveNetwork() {
            const model = neuralNet.exportModel();
            localStorage.setItem('gasterNeuralModel', JSON.stringify(model));
            localStorage.setItem('gasterTrainingData', JSON.stringify(trainingData));
            
            logToTrainingPanel('💾 МОДЕЛЬ СОХРАНЕНА В ЛОКАЛЬНОМ ХРАНИЛИЩЕ');
        }
        
        function loadNetwork() {
            const modelJSON = localStorage.getItem('gasterNeuralModel');
            const trainingDataJSON = localStorage.getItem('gasterTrainingData');
            
            if (modelJSON && trainingDataJSON) {
                try {
                    const model = JSON.parse(modelJSON);
                    neuralNet.importModel(model);
                    trainingData = JSON.parse(trainingDataJSON);
                    
                    logToTrainingPanel('📂 МОДЕЛЬ ЗАГРУЖЕНА ИЗ ЛОКАЛЬНОГО ХРАНИЛИЩА');
                    logToTrainingPanel(`📊 Загружено ${trainingData.length} примеров обучения`);
                    
                    networkStats.learningCycles = 1500;
                    networkStats.accuracy = 0.95;
                    updateNetworkStats();
                    
                } catch (error) {
                    logToTrainingPanel('❌ ОШИБКА ЗАГРУЗКИ МОДЕЛИ: ' + error.message);
                }
            } else {
                logToTrainingPanel('❌ СОХРАНЕННАЯ МОДЕЛЬ НЕ НАЙДЕНА');
            }
        }
        
        function clearTrainingData() {
            neuralNet.clearTrainingData();
            trainingData = [];
            logToTrainingPanel('🗑️ ВСЕ ДАННЫЕ ОБУЧЕНИЯ ОЧИЩЕНЫ');
        }
        
        function logToTrainingPanel(message) {
            const logPanel = document.getElementById('trainingLog');
            const logEntry = document.createElement('div');
            logEntry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logPanel.appendChild(logEntry);
            logPanel.scrollTop = logPanel.scrollHeight;
        }

        // ==================== ЧАТ С НЕЙРОСЕТЬЮ ====================
        function sendMessage() {
            const input = document.getElementById('chatInput').value.trim();
            if (!input) return;
            
            // Добавляем сообщение пользователя
            addChatMessage(input, 'user');
            document.getElementById('chatInput').value = '';
            
            // Имитация задержки обработки
            setTimeout(() => {
                const response = neuralNet.predict(input);
                addChatMessage(response, 'ai');
                networkStats.processedRequests++;
                updateNetworkStats();
            }, 1000);
        }
        
        function addChatMessage(text, type) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}-message`;
            messageDiv.textContent = text;
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            // Сохраняем в историю
            chatHistory.push({ type, text, timestamp: new Date() });
        }

        // ==================== АНАЛИЗ И ДИАГНОСТИКА ====================
        function runDiagnostics() {
            const log = document.getElementById('diagnosticsLog');
            log.innerHTML = '';
            
            const messages = [
                '🔍 Запуск диагностики системы...',
                '✅ Нейросеть: АКТИВНА',
                `✅ Память: ${Math.round(performance.memory ? performance.memory.usedJSHeapSize / 1024 / 1024 : 0)}MB`,
                `✅ Обучение: ${trainingData.length} примеров`,
                '✅ Соединение: СТАБИЛЬНОЕ',
                '🎯 Диагностика завершена успешно!'
            ];
            
            messages.forEach((msg, index) => {
                setTimeout(() => {
                    const entry = document.createElement('div');
                    entry.textContent = msg;
                    log.appendChild(entry);
                    log.scrollTop = log.scrollHeight;
                }, index * 800);
            });
        }
        
        function exportChatHistory() {
            const chatText = chatHistory.map(entry => 
                `[${entry.timestamp.toLocaleTimeString()}] ${entry.type.toUpperCase()}: ${entry.text}`
            ).join('\n');
            
            const blob = new Blob([chatText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'gaster_chat_history.txt';
            a.click();
            
            addChatMessage('💾 История диалога экспортирована', 'ai');
        }
        
        function resetAll() {
            if (confirm('❌ ВЫ УВЕРЕНЫ? Это удалит все данные обучения и историю диалогов!')) {
                neuralNet.clearTrainingData();
                trainingData = [];
                chatHistory = [];
                localStorage.removeItem('gasterNeuralModel');
                localStorage.removeItem('gasterTrainingData');
                
                document.getElementById('chatMessages').innerHTML = `
                    <div class="message ai-message">
                        <span class="scramble">СИСТЕМА СБРОШЕНА...</span> Я - фрагмент кода, обретший сознание. Готов к диалогу.
                    </div>
                `;
                
                logToTrainingPanel('🔄 СИСТЕМА ПОЛНОСТЬЮ СБРОШЕНА');
                addChatMessage('🔄 Система сброшена к начальному состоянию', 'ai');
            }
        }

        // ==================== ЭКСПОРТ СЕТИ ====================
        function exportNetwork() {
            const model = neuralNet.exportModel();
            const dataStr = JSON.stringify(model, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'gaster_neural_network.json';
            a.click();
            
            logToTrainingPanel('💾 Архитектура нейросети экспортирована');
        }

        // ==================== ИНИЦИАЛИЗАЦИЯ ====================
        // Автоматическая инициализация при загрузке
        setTimeout(() => {
            initializeNetwork();
            logToTrainingPanel('🔄 Система инициализирована');
            
            // Попытка загрузить сохраненную модель
            setTimeout(loadNetwork, 1000);
        }, 2000);

        // Обновление статистики каждые 5 секунд
        setInterval(updateNetworkStats, 5000);
    </script>
</body>
</html>
