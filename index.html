<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å Hugging Face API</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        #loadingIndicator { display: none; font-size: 1.5em; color: #888; }
        #contentOutput { margin-top: 20px; white-space: pre-wrap; word-wrap: break-word; }
        .mode-btn { cursor: pointer; padding: 10px; background-color: #f0f0f0; border: 1px solid #ccc; margin-right: 10px; }
        .mode-btn.active { background-color: #ddd; }
    </style>
</head>
<body>
    <h1>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å Hugging Face API</h1>
    <textarea id="description" rows="4" cols="50" placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å..."></textarea><br><br>
    <button id="generateBtn">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å</button>
    <div id="loadingIndicator">–ü–æ–∏—Å–∫ –≤ –ü—É—Å—Ç–æ—Ç–µ...</div>
    <div id="contentOutput"></div>

    <div>
        <button class="mode-btn active" data-mode="code">–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–¥–∞</button>
        <button class="mode-btn" data-mode="text">–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞</button>
    </div>

    <script>
        const apiToken = "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"; // –¢–≤–æ–π —Ä–∞–±–æ—á–∏–π —Ç–æ–∫–µ–Ω Hugging Face
        let lastGeneratedContent = '';
        let currentMode = 'code';
        let currentTier = 'basic'; // –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –º–æ–∂–Ω–æ —Å—Ä–∞–∑—É –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å

        async function callHuggingFaceAPI(prompt, model) {
            const url = `https://api-inference.huggingface.co/models/${model}`;
            const maxTokens = currentMode === 'text' ? 400 : 200;
            const temperature = currentMode === 'text' ? 0.7 : 0.3;

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${apiToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        inputs: prompt,
                        parameters: {
                            max_new_tokens: maxTokens,
                            temperature: temperature,
                            do_sample: true,
                            top_p: 0.9,
                            repetition_penalty: 1.1
                        },
                        options: {
                            wait_for_model: true,
                            use_cache: false
                        }
                    })
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    let errorMessage = `HTTP ${response.status}: ${response.statusText}`;
                    try {
                        const errorData = JSON.parse(errorText);
                        errorMessage = errorData.error || errorData.message || errorMessage;
                    } catch (e) {
                        errorMessage = errorText || errorMessage;
                    }
                    throw new Error(errorMessage);
                }

                const result = await response.json();
                let generatedText = '';

                if (Array.isArray(result) && result.length > 0) {
                    generatedText = result[0].generated_text || result[0].translation_text || result[0].summary_text || JSON.stringify(result[0]);
                } else if (result.generated_text !== undefined) {
                    generatedText = result.generated_text;
                } else {
                    generatedText = JSON.stringify(result);
                }

                // –£–¥–∞–ª—è–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π –ø—Ä–æ–º–ø—Ç –∏–∑ –æ—Ç–≤–µ—Ç–∞
                if (generatedText.startsWith(prompt)) {
                    generatedText = generatedText.slice(prompt.length);
                }

                return {
                    success: true,
                    content: generatedText.trim()
                };
            } catch (error) {
                return {
                    success: false,
                    error: error.message
                };
            }
        }

        document.getElementById('generateBtn').addEventListener('click', async () => {
            const prompt = document.getElementById('description').value.trim();
            if (!prompt) {
                alert("–í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å");
                return;
            }

            // –õ–∏–º–∏—Ç BASIC
            if (currentTier === "basic" && questionCount >= 10) {
                alert("–î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –≤–æ–ø—Ä–æ—Å–æ–≤ (10)");
                return;
            }
            questionCount++;

            const mode = document.querySelector('.mode-btn.active').dataset.mode;

            document.getElementById('loadingIndicator').style.display = "block";
            document.getElementById('contentOutput').textContent = "";
            await voidSearchAnimation(2000); // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ–∏—Å–∫–∞

            try {
                let answer = await generateHF(prompt, mode);
                // IQ 500 —É –ì–∞—Å—Ç–µ—Ä–∞ - –¥–æ–±–∞–≤–ª—è–µ–º –≥–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑
                if (mode === "text") answer = "üíÄ –ì–∞—Å—Ç–µ—Ä –¥—É–º–∞–µ—Ç –≥–ª—É–±–æ–∫–æ... IQ 500 üíÄ\n\n" + answer;
                document.getElementById('contentOutput').textContent = answer;
            } catch (err) {
                document.getElementById('contentOutput').textContent = "–û—à–∏–±–∫–∞: " + err.message;
            } finally {
                document.getElementById('loadingIndicator').style.display = "none";
            }
        });

        // –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–æ–¥ —Ç–µ—Å—Ç–µ—Ä–∞
        function checkTesterCode(code) {
            return code === "LansBeholder";
        }

        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ: –±—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø —Ç–µ—Å—Ç–µ—Ä–æ–≤
        if (currentTier === "tester") {
            questionCount = 0; // –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ
        }
    </script>
</body>
</html>
